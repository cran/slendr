<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Installation instructions</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>







<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Installation instructions</h1>



<div id="quick-installation" class="section level2">
<h2>Quick installation</h2>
<p><em>slendr</em> is available on the CRAN R package repository. As
such, you can install it simply by executing
<code>install.packages(&quot;slendr&quot;)</code> in your R console.</p>
<p>If you want (or need) to get its development version, you can install
it directly from GitHub by executing
<code>devtools::install_github(&quot;bodkan/slendr&quot;)</code> via the R package
<em>devtools</em> (you can gen <em>devtools</em> by running
<code>install.packages(&quot;devtools&quot;)</code>). In fact, if you decide to
try <em>slendr</em>, please make sure to update it regularly and keep an
eye on the <a href="https://www.slendr.net/news/index.html">changelog</a> on a regular
basis! This is where you can find information about latest bugfixes and
potential breaking changes.</p>
<p>Once you install <em>slendr</em>, <strong>calling
<code>library(slendr)</code> will check that all software dependencies
are available</strong>. If they are not, the R package will provide a
brief helpful guide on how to resolve potential issues. The rest of this
vignette talks about the necessary software dependencies in a bit more
detail.</p>
<p><strong>Please note that <em>slendr</em> has been extensively tested
only on macOS and Linux at the moment.</strong> However, there is an
experimental support for runnig both SLiM and <em>msprime</em>
simulations on Windows and for analyzing tree-sequence outputs using its
<em>tskit</em> interface on this platform as well. Feedback on issues
with using <em>slendr</em> on Windows is highly appreciated.</p>
</div>
<div id="software-dependencies" class="section level2">
<h2>Software dependencies</h2>
<p><em>slendr</em> relies on three main software dependencies:</p>
<ol style="list-style-type: decimal">
<li><p>geospatial data analysis R package <a href="https://r-spatial.github.io/sf/"><em>sf</em></a> (for encoding
spatial <em>slendr</em> models and analysing spatial tree-sequence
data),</p></li>
<li><p>forward population genetic simulator <a href="https://messerlab.org/slim/">SLiM</a> (for forward
simulations),</p></li>
<li><p>Python modules <a href="https://tskit.dev/"><em>tskit</em>,
<em>msprime</em>, and <em>pyslim</em></a> (for coalescent simulations
and tree-sequence analysis), and also <em>pandas</em> used internally by
the simulation back ends.</p></li>
</ol>
<p>All three are widely used in their respective fields and, as such,
are easily obtainable on all major operating systems (see below for more
information on how to troubleshoot potential problems).</p>
<p><strong>Note that depending on your use case, not all three sets of
dependencies will be necessarily needed.</strong> If you’re not going to
be running forward spatial simulations, you don’t need SLiM or
geospatial R packages <em>sf</em>, <em>stars</em>, and
<em>rnaturalearth</em>. This applies also to the animation of spatial
models using the <em>gganimate</em> R package. <strong>This is why
<em>slendr</em> does not install those as dependencies. If you need this
functionality, you will have to install the respective R packages
manually.</strong></p>
<p>In this vignette, I will briefly explain how to get all
<em>slendr’</em>s software dependencies installed. That said, note that
under normal circumstances (with the exception of SLiM), no manual
installation of individual dependencies is required.</p>
<div id="sf-stars-rnaturalearth" class="section level3">
<h3><em>sf</em>, <em>stars</em>, <em>rnaturalearth</em></h3>
<p>The R package <em>sf</em> is at the heart of geospatial data analysis
in R. It is available on CRAN and can be installed for all major
platforms by executing <code>install.packages(&quot;sf&quot;)</code> in your R
session. The same applies for <em>stars</em> and
<em>rnaturalearth</em>.</p>
<p>When you first load <em>slendr</em> via <code>library(slendr)</code>,
if you’re missing any of the three geospatial R packages, you will be
notified and instructed how you can easily obtain them from CRAN using a
single call to <code>install.packages()</code>.</p>
<p>That said, <em>sf</em> itself depends on a number of geospatial
libraries and depending on the exact setup of your Linux or macOS
machine, some of those libraries could be missing. Luckily, all of them
are very easy to install via Homebrew (on macOS) or via the appropriate
package manager of your Linux distribution (Ubuntu, Fedora, etc.).
Detailed instructions on how to do this for your operating system can be
found <a href="https://r-spatial.github.io/sf/index.html#installing">here</a>.</p>
<p><strong>If you’re having problems with the installation of any of
these three packages, look for help <a href="https://r-spatial.github.io/sf/index.html#installing">here</a>.</strong></p>
<div id="macos" class="section level4">
<h4><strong>macOS</strong></h4>
<p>One user who recently installed <em>slendr</em> on a fresh macOS
system reported that they needed to install <code>libgit2</code> in
order to be able to install the package <em>devtools</em> for the
<code>devtools::install_github(&quot;bodkan/slendr&quot;)</code> step described on
top of this page.</p>
<p>Additionally, they had to install a couple of C/C++ libraries as well
(all dependencies of the <em>sf</em> package). In the end, they were
able to successfully install <em>slendr</em> after running:</p>
<pre><code>brew install libgit2 udunits gdal proj</code></pre>
<p>Note that this assumes that you have the <a href="https://brew.sh/">Homebrew</a> package manager already setup on
your Mac. If you’re a beginning computational scientist using a Mac, I
strongly encourage you to install Homebrew. Sooner or later you will
need some specific Linux/unix program anyway, and Homebrew is the way to
get it (Mac is a unix machine, but without Homebrew a very poor one by
default).</p>
</div>
<div id="linux" class="section level4">
<h4><strong>Linux</strong></h4>
<p>Testing <em>slendr</em> installation on a fresh, pristine Debian
installation with no dependencies previously installed, I had to run the
following:</p>
<pre><code>sudo apt-get install libudunits2-dev libssl-dev libgdal-dev libgsl-dev libgit2-dev libfontconfig1-dev libharfbuzz-dev libfribidi-dev</code></pre>
<p>It’s very unlikely you would need all of the above (and you might
need other packages on non-Debian distributions), but this is what got
<em>slendr</em> and all of its dependencies running on a completely
clean system. Might be a good start in case you have trouble on your
Linux machine.</p>
<p><strong>Windows</strong></p>
<p>No special treatment should be necessary to get <em>slendr</em>
running. If you install <em>slendr</em> via
<code>install.packages(&quot;slendr&quot;)</code>, you will get the binary version
of the package and all its dependencies without any need for compiling
sources.</p>
</div>
</div>
<div id="slim" class="section level3">
<h3>SLiM</h3>
<p>The forward population genetic software SLiM is available on all
major software platforms. Its complete installation instructions can be
found <a href="https://messerlab.org/slim/">here</a>. <strong>On a
Mac</strong>, I recommend installing SLiM via the <code>pkg</code>
installer available for direct download from its <a href="https://messerlab.org/slim/">website</a>. <strong>On
Linux</strong>, you can either install SLiM via the appropriate package
manager for your Linux distribution (see SLiM manual <a href="https://messerlab.org/slim/">here</a> for more information), or
you can easily compile your own. To install SLiM <strong>on
Windows</strong>, please follow the instructions in section 2.3.1 of the
SLiM manual. Note that although SLiM is also available on conda, it
comes without SLiMgui!</p>
<p>Note that <em>slendr</em> requires SLiM 4.0 and will not work with an
earlier version. Again, running <code>library(slendr)</code> will inform
you of any potential issues with your SLiM installation.</p>
<div id="adding-slim-to-the-path" class="section level4">
<h4>Adding SLiM to the <code>$PATH</code></h4>
<p>In order for <em>slendr</em> to be able to find your SLiM
installation, R must be able to find the <code>slim</code> binary (or
<code>slim.exe</code> in case of Windows) in the so called <a href="https://en.wikipedia.org/wiki/PATH_(variable)"><code>$PATH</code>
variable</a>. The easiest way to verify that this is true is to call
<code>Sys.which(&quot;slim&quot;)</code> (or <code>Sys.which(&quot;slim.exe&quot;)</code> on
Windows) in your R session. For instance, on my own Mac, I get this:</p>
<pre><code>&gt; Sys.which(&quot;slim&quot;)
                 slim 
&quot;/usr/local/bin/slim&quot; </code></pre>
<p>On Windows, I get this (I followed the section 2.3.1 of the SLiM
manual describing the most “official” way to install SLiM and I
recommend you follow this as well):</p>
<pre><code>&gt; Sys.which(&quot;slim.exe&quot;)
                            slim.exe 
&quot;C:\\msys64\\mingw64\\bin\\slim.exe&quot; </code></pre>
<p>If, on the other hand, you might get something like this — an empty
string:</p>
<pre><code>&gt; Sys.which(&quot;slim&quot;)
slim 
  &quot;&quot; </code></pre>
<p><strong>This means that your <code>$PATH</code> R is not configured
properly and R (and <em>slendr</em>) won’t be able to find SLiM in the
<code>$PATH</code>.</strong></p>
<p>How to add SLiM to the <code>$PATH</code> then? Probably the most
convenient way to do this is by editing the <code>.Renviron</code> file.
The precise location of this file depends on your operation system but
you can automatically get it open in a text editor by using this command
(you might have to do <code>install.packages(&quot;usethis&quot;)</code>
first):</p>
<pre><code>usethis::edit_r_environ()</code></pre>
<p>Then, you can either add the following (note that there’s no
<code>$</code> in this line!):</p>
<pre><code>PATH=&quot;&lt;path to directory with SLiM binaries&gt;&quot;</code></pre>
<p>Alternatively, should you already have some <code>$PATH</code>
contents specified for your R session, you can get it by calling
<code>Sys.getenv(&quot;PATH&quot;)</code> in your R console, grab the entire
string you get in this way, and append the path where you installed SLiM
using an appropriate delimiter (<code>:</code> on Linux/macOS,
<code>;</code> on Windows) to this string. In this case, the edit might
look something like this:</p>
<pre><code>PATH=&quot;&lt;original Sys.getenv(&quot;PATH&quot;) content&gt;&lt;delimiter&gt;&lt;path to directory with SLiM binaries&gt;&quot;</code></pre>
<p>For instance, on my Mac, the <code>.Renviron</code> file contains
this line (note the last item <code>/usr/local/bin</code> matches the
path to <code>slim</code> I showed above):</p>
<pre><code>PATH=&quot;/opt/homebrew/bin:/opt/homebrew/sbin:/Users/mp/.my_local/bin:/Users/mp/.my_local/AdmixTools/bin:/Library/TeX/texbin:/opt/homebrew/opt/gnu-sed/libexec/gnubin:/opt/homebrew/opt/coreutils/libexec/gnubin:/usr/local/bin&quot;</code></pre>
<p>On my testing Windows machine, I have this in the
<code>.Renviron</code> file (again, look for the path
<code>C:/msys64/mingw64/bin;$PATH&quot;</code> which matches the
<code>slim.exe</code> binary shown above):</p>
<pre><code>PATH=&quot;C:\\msys64\\usr\\bin;C:\\rtools43\\x86_64-w64-mingw32.static.posix\\bin;C:\\rtools43\\usr\\bin;C:\\Program Files (x86)\\R\\R-4.3.2\\bin\\x64;C:/msys64/mingw64/bin&quot;</code></pre>
<p><strong>The most important check that your R can find SLiM is using
the <code>Sys.which()</code> command described above. Before this gives
you a positive result, you won’t be able to use <em>slendr</em>’s
spatial SLiM simulations<em>.</em> If you’re struggling with this,
search for advice related to <code>.Renviron</code> and
<code>$PATH</code> online.</strong></p>
<div id="fallback-options" class="section level5">
<h5>Fallback options</h5>
<p>If you don’t want to deal with editing the <code>.Renviron</code>
file, you should be able to set the path to SLiM using the command
<code>Sys.setenv(PATH = &quot;&lt;path to directory with SLiM binaries&gt;&quot;)</code>.
You will have to do this at the beginning of each of your slendr R
scripts though.</p>
<p>Alternatively, the <code>slim()</code> function has an argument
<code>slim_path=</code> where you can specify the full path to the
<code>slim</code> or <code>slim.exe</code> binaries directly (not the
directory as it’s the case with the <code>$PATH</code>! the full path to
the <code>slim</code>/<code>slim.exe</code> binary itself).</p>
</div>
</div>
</div>
<div id="python" class="section level3">
<h3>Python</h3>
<p>In order to be able to run coalescent simulations and process
tree-sequence files, <em>slendr</em> needs Python modules
<em>tskit</em>, <em>msprime</em>, and <em>pyslim</em> (it also needs the
<em>pandas</em> library).</p>
<p>Setting up an isolated Python environment with specific version of
Python packages (which is very important to avoid clashes among
different Python programs needed by your system) can be a <a href="https://xkcd.com/1987/">bit of a hassle</a> for some users. This
is especially true for R users who might not use Python in their daily
work.</p>
<p>In order to make sure that the R package has the most appropriate
version of Python available, with the correct versions of all of its
Python module dependencies, <em>slendr</em> provides a dedicated
function <code>setup_env()</code> which automatically <strong>downloads
a completely separate Python distribution and installs the required
versions of <em>tskit</em>, <em>msprime</em>, and <em>pyslim</em>
modules into a dedicated virtual environment</strong>. Moreover, this
Python installation and virtual environment are <strong>entirely
isolated from other Python configurations that are already present on
the user’s system</strong>, avoiding potential conflicts with the
versions of Python and Python modules required by <em>slendr</em>.</p>
<p><strong>Next time you call <code>library(slendr)</code>, you will
need to activate this environment automatically by calling
<code>init_env()</code></strong>. If you’re not comfortable with Python
you don’t need to worry beyond calling <code>setup_env()</code> and
<code>init_env()</code>, no interaction with Python is necessary for
working with <em>slendr</em> in R.</p>
<div id="failing-conda" class="section level4">
<h4>Failing <em>conda</em>?</h4>
<p>In order to support Windows, <em>slendr</em> uses conda to download a
Python interpreter as explained above. Given this fact, when you run
<code>setup_env()</code>, <em>slendr</em> tries to leverage conda being
present to install its Python dependencies (<em>msprime</em>,
<em>tskit</em>, <em>pyslim</em>, <em>pandas</em>) via conda itself.</p>
<p>Unfortunately, conda can break for frustratingly many random reasons
which completely trips up <code>setup_env()</code>. If you run into this
issue, <strong>there is a fallback option to install Python dependencies
<em>msprime</em>, <em>tskit</em>, <em>pyslim</em>, and <em>pandas</em>
via <code>pip</code></strong> which, unlike conda, works practically
every time. If your <code>setup_env()</code> fails for some
conda-related reason, first clear the broken environment by calling
<code>clear_env()</code>, restart your R session, and then <strong>call
<code>setup_env(pip = TRUE)</code></strong> instead of the default
<code>setup_env()</code>. Note that <strong>this might require you to
install the <a href="https://www.gnu.org/software/gsl/">GSL</a>
numerical library, but that’s a trivial issue on macOS
(<code>brew install gsl</code>) and Linux (on Ubuntu, for instance,
<code>sudo apt-get install libgsl-dev</code>)</strong>.</p>
</div>
<div id="information-for-python-experts" class="section level4">
<h4>Information for Python experts</h4>
<p>In case you are wondering how does <em>slendr</em> accomplish the
above: <em>slendr</em>’s Python interface is implemented using the R
package <a href="https://rstudio.github.io/reticulate/"><em>reticulate</em></a><em>.</em>
This embeds a Python interpreter <em>inside</em> an R session, enabling
high-performance interoperability between both languages without any
need for user intervention.</p>
</div>
<div id="modulenotfounderror-no-module-named-tskit-error" class="section level4">
<h4><code>ModuleNotFoundError: No module named &#39;tskit&#39;</code> error</h4>
<p>If you’re running into this error, it means that <em>slendr</em> was
prevented from activating its internal Python virtual environment. Most
likely you either didn’t run <code>setup_env()</code> as described
above, or you forgot to run <code>init_env()</code> before attempting to
simulate tree sequence data, or the Python environment got somehow
corrupted. All of these cause <em>slendr</em>’s internal machinery to
fail to pick up it’s Python dependencies for tree-sequence simulation
and analysis, leading to the <code>No module named &#39;tskit&#39;</code>
error.</p>
<p>Before reporting this error on GitHub, please carefully read <a href="https://github.com/bodkan/slendr/issues/154#issuecomment-1997714497">this
writeup</a> which I put together when a user reported the same error. It
contains all the required information on how does <em>slendr</em>’s
Python environment activation works and why, and why you’re running into
the error. Because this issue is almost always caused by a problem
outside of <em>slendr</em>’s influence, it’s important that you
understand what’s going on before reporting what is often assumed to be
a <em>slendr</em> bug when in reality it isn’t.</p>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
